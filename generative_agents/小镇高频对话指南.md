# 四人高频对话实验 - 在小镇中活动

## 核心改进

### 1. 对话频率大幅提升
- ✅ 对话间隔：60分钟 → **15分钟**
- ✅ 思考速度：1000ms → **500ms**
- ✅ 对话深度：4轮 → **10轮**
- ✅ 视野范围：8格 → **10格**（更容易遇到其他人）

### 2. 四个核心角色
- 伊莎贝拉（咖啡馆老板）
- 玛丽亚（学生）
- 卡门（供应店主人）
- 塔玛拉（儿童读物作家）

### 3. 对话内容优化
- ✅ 使用Novlang符号语言
- ✅ 避免重复对话
- ✅ 鼓励创新表达

## 快速开始

### 方式1: 使用start.py（推荐 - 完整小镇模拟）

```powershell
cd generative_agents

# 运行10步，每步推进10分钟，agents会在小镇里活动并对话
python start.py --name town-chat-1 --step 10 --stride 10

# 继续之前的实验
python start.py --name town-chat-1 --resume --step 10 --stride 10

# 调试模式（更详细的日志）
python start.py --name town-chat-1 --step 10 --stride 10 --verbose debug
```

### 方式2: 使用party_chat.py（纯对话实验）

```powershell
# 强制对话模式（agents轮流配对对话）
python party_chat.py --name party-1 --rounds 20 --novlang-file data\prompts\novlang_rules_clean.txt
```

## 参数说明

### start.py 参数
- `--name`: 实验名称
- `--step`: 模拟步数（每步agents会思考和行动一次）
- `--stride`: 每步推进的时间（分钟），建议5-10分钟
- `--resume`: 继续之前的实验
- `--verbose`: 日志级别 (debug/info/warning)

### 预期效果

**10步实验（每步10分钟 = 100分钟模拟时间）：**
- agents在小镇中移动、工作、互动
- 每15分钟可能再次对话（理论上约6-7次对话机会）
- 实际对话次数取决于：
  - agents是否相遇
  - 他们的活动计划
  - LLM是否判断应该对话

**对话触发条件：**
1. ✅ 两人在同一区域
2. ✅ 距离上次对话 ≥ 15分钟
3. ✅ 都不在睡觉
4. ✅ 都不在移动中
5. ✅ LLM判断应该对话

## 查看结果

### 实时监控

```powershell
# 查看最新对话（从conversation.json）
Get-Content results\checkpoints\town-chat-1\conversation.json | ConvertFrom-Json | Select-Object -Last 1

# 查看agents状态（从最新的simulate文件）
$latest = Get-ChildItem results\checkpoints\town-chat-1\simulate-*.json | Sort-Object LastWriteTime -Descending | Select-Object -First 1
Get-Content $latest.FullName
```

### 检查点文件结构

```
results/checkpoints/town-chat-1/
  ├── conversation.json          # 所有对话记录（按时间）
  ├── simulate-20240213-1000.json  # Agent状态快照
  ├── simulate-20240213-1010.json
  └── ...
```

### 对话记录格式

```json
{
  "20240213-10:30": [
    {
      "伊莎贝拉 -> 玛丽亚 @ 霍布斯咖啡馆，吧台": [
        ["伊莎贝拉", "●·↔·△：咖啡", "我想和大家喝咖啡聊天"],
        ["玛丽亚", "♡·⊗·△·→·⊕", "开心的情绪融入群体带来能量"]
      ]
    }
  ]
}
```

## 如何进一步提高对话频率

### 1. 减少对话间隔限制

编辑 `modules/agent.py` 第537行左右：

```python
# 当前设置：15分钟
if delta < 15:
    return False

# 改为5分钟（非常高频）
if delta < 5:
    return False

# 或完全移除限制（可能导致过度对话）
# if delta < 1:
#     return False
```

### 2. 缩短时间推进

```powershell
# 每步只推进5分钟（更密集的互动机会）
python start.py --name town-chat-2 --step 20 --stride 5
```

### 3. 增加感知范围

编辑 `data/config.json`：

```json
{
  "agent": {
    "percept": {
      "vision_r": 15,      // 从10增加到15
      "att_bandwidth": 15  // 更大的注意力范围
    }
  }
}
```

### 4. 调整活动计划多样性

编辑 `data/config.json`：

```json
{
  "agent": {
    "schedule": {
      "diversity": 3  // 从5减少到3，活动更集中，相遇概率更高
    }
  }
}
```

## 对话质量优化

### 避免重复

提示词已经优化：
- ✅ 强调不重复对话记录中的内容
- ✅ 鼓励创新表达
- ✅ 移除了固定示例

### 使用纯符号

- ✅ 提示词要求主要使用符号
- ✅ 专有名词只在":"后使用
- ✅ 提供了多种表达模式参考

## 实验建议

### 短期测试（10-20步）
```powershell
python start.py --name test-short --step 10 --stride 10
```
目的：验证配置正确，agents能正常对话

### 中期实验（50-100步）
```powershell
python start.py --name test-mid --step 50 --stride 10
```
目的：观察对话模式演化，语言涌现初现

### 长期实验（200+步）
```powershell
python start.py --name test-long --step 100 --stride 10
# 完成后继续
python start.py --name test-long --resume --step 100 --stride 10
```
目的：完整的语言涌现过程观察

## 故障排除

### 问题：agents不对话

**检查：**
1. agents是否在同一区域？
2. 他们在做什么（睡觉/移动中）？
3. 上次对话距离现在多久？

**解决：**
- 减小 `stride`（如5分钟）
- 减小对话间隔限制（如5分钟）
- 增加 `vision_r`

### 问题：对话内容重复

**解决：**
- 提示词已优化，应该会好很多
- 如果还重复，可能是LLM temperature太低
- 尝试不同的novlang规则文件

### 问题：运行缓慢

**解决：**
- 减少agents数量（已经是4个）
- 使用更小的LLM模型
- 增加 `stride`（减少模拟密度）

## 数据分析

运行完成后，可以统计：

```powershell
# 统计对话总数
$conv = Get-Content results\checkpoints\town-chat-1\conversation.json | ConvertFrom-Json
$conv.PSObject.Properties | Measure-Object

# 分析对话时间分布
$conv.PSObject.Properties.Name

# 提取所有对话内容
$conv.PSObject.Properties.Value | ForEach-Object { $_ }
```

## 总结

现在的配置实现了：
- ✅ agents在小镇中正常生活、工作
- ✅ 对话频率大幅提升（15分钟间隔）
- ✅ 使用Novlang符号语言
- ✅ 避免重复对话
- ✅ 只保留4个核心角色

**立即开始：**
```powershell
cd generative_agents
python start.py --name my-experiment --step 20 --stride 10 --verbose info
```
