# 四人语言涌现实验配置指南

## 概述
这个配置专门用于语言涌现实验，让四个AI角色（伊莎贝拉、玛丽亚、卡门、塔玛拉）持续对话，使用Novlang符号语言进行交流。

## 参与角色

1. **伊莎贝拉** (Isabella) - 咖啡馆老板
2. **玛丽亚** (Maria) - 学生  
3. **卡门** (Carmen) - 供应店主人
4. **塔玛拉** (Tamara) - 儿童读物作家

## 快速开始

### 使用party_chat.py（推荐用于语言涌现实验）

```powershell
# 激活环境
conda activate generative_agents_cn

# 进入目录
cd generative_agents

# 运行100轮对话实验
python party_chat.py --name lang-emerge-1 --rounds 100 --novlang-file data\prompts\novlang_rules.txt

# 继续之前的实验
python party_chat.py --name lang-emerge-1 --rounds 100 --resume --novlang-file data\prompts\novlang_rules.txt
```

### 使用start.py（传统模拟方式）

```powershell
# 运行10步模拟（已经修改为只包含四个人）
python start.py --name sim-test-4p --step 10 --stride 10
```

## 关键优化参数

### data/config.json 优化建议

```json
{
    "agent": {
        "chat_iter": 8,          // 增加到8，让对话更深入
        "think": {
            "interval": 500,      // 从1000减少到500，提高响应频率
            "poignancy_max": 150
        },
        "associate": {
            "retention": 12       // 从8增加到12，增强记忆保留
        }
    }
}
```

### party_chat.py 参数说明

- `--name`: 实验名称，例如 "lang-emerge-1"
- `--rounds`: 对话轮次，建议100-1000轮
- `--novlang-file`: Novlang规则文件路径
- `--resume`: 继续之前的实验
- `--verbose`: 日志级别 (debug/info/warning)

## 实验数据保存位置

```
results/
  party_chat/
    lang-emerge-1/           # 你的实验名称
      rounds.json            # 所有对话轮次记录
      conversation.json      # 对话历史
      checkpoint-round-X.json # 检查点文件
```

## 观察语言涌现的技巧

1. **监控符号使用频率**
   - 查看哪些Novlang符号被频繁使用
   - 观察新的符号组合模式

2. **追踪语义稳定化**
   - 某些符号组合是否形成固定含义
   - 角色之间是否达成共识

3. **分析对话效率**
   - 表达是否越来越简洁
   - 理解是否越来越准确

## 提高对话效率的建议

### 1. 减少思考间隔
在 `data/config.json` 中:
```json
"think": {
    "interval": 300  // 从500进一步减少到300毫秒
}
```

### 2. 增加对话迭代
```json
"chat_iter": 10  // 增加到10次迭代
```

### 3. 优化记忆系统
```json
"associate": {
    "retention": 15,  // 保留更多相关记忆
    "embedding": {
        "provider": "hugging_face",
        "model": "sentence-transformers/all-MiniLM-L6-v2"
    }
}
```

### 4. 调整感知范围
```json
"percept": {
    "mode": "box",
    "vision_r": 10,      // 增加视野范围
    "att_bandwidth": 10  // 增加注意力带宽
}
```

## 故障排除

### 问题：对话不够频繁
**解决方案：**
1. 减小 `think.interval` (建议300-500)
2. 增加 `chat_iter` (建议8-10)
3. 增加 `percept.att_bandwidth`

### 问题：角色不使用Novlang
**解决方案：**
1. 确保 `--novlang-file` 参数正确
2. 检查 `data/prompts/generate_chat.txt` 包含Novlang规则
3. 在prompt中强调"必须使用Novlang"

### 问题：对话重复或无意义
**解决方案：**
1. 增加 `schedule.diversity` 参数
2. 增加 `associate.retention` 增强记忆
3. 调整LLM的temperature参数（如果支持）

## 实验监控命令

```powershell
# 实时查看最新的对话记录
Get-Content results\party_chat\lang-emerge-1\rounds.json -Tail 50

# 统计对话数量
(Get-Content results\party_chat\lang-emerge-1\rounds.json | ConvertFrom-Json).Count

# 查看检查点
Get-ChildItem results\party_chat\lang-emerge-1\checkpoint-*.json | Sort-Object LastWriteTime -Descending | Select-Object -First 1
```

## 高级技巧

### 只让特定角色对话
修改 `party_chat.py` 中的 `EXPERIMENT_PERSONAS` 列表：
```python
EXPERIMENT_PERSONAS = [
    "伊莎贝拉",
    "玛丽亚",
    # "卡门",    # 注释掉不需要的角色
    # "塔玛拉",
]
```

### 添加对话主题引导
在 `party_chat.py` 的 `_build_conversation_prompt` 方法中添加主题：
```python
prompt_parts.append("对话主题：讨论新的交流方式")
```

### 设置对话目标
```python
prompt_parts.append("目标：共同创造一种更高效的符号组合方式")
```

## 性能优化

### 使用更快的LLM
在 `data/config.json` 中：
```json
"think": {
    "llm": {
        "provider": "ollama",
        "model": "qwen2.5:7b-instruct-q4_K_M",  // 使用量化模型
        "base_url": "http://127.0.0.1:11434/v1",
        "api_key": ""
    }
}
```

### 并行处理（未来改进）
目前是顺序对话，可以考虑实现：
- 多线程agent思考
- 异步LLM调用
- 批量记忆更新

## 数据分析建议

实验结束后，可以分析：
1. 符号使用频率分布
2. 语义稳定性演化
3. 对话效率变化曲线
4. 共识形成过程

可以编写Python脚本分析 `rounds.json` 文件。

## 联系与支持

如有问题，请查看：
- README.md - 项目总体说明
- docs/ollama.md - LLM配置说明
- 项目GitHub Issues
